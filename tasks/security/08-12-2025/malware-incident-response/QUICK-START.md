# Quick Reference - EXECUTE NOW

## üö® CRITICAL: Server Terinfeksi Malware!

### Status:
- **Malware:** Crypto miner "linuxsys" 
- **CPU Usage:** 397% (4 cores @ 100%)
- **Next.js:** 16.0.0 (VULNERABLE to CVE-2025-66478)
- **Rootkit:** Active (`/etc/ld.so.preload` modified)

---

## üî¥ LANGKAH 1: EKSEKUSI SEGERA (Prioritas Tertinggi)

```bash
# Jalankan script emergency response
sudo /app/tasks/security/08-12-2025/malware-incident-response/emergency-response.sh
```

Script ini akan:
1. ‚úÖ Mengumpulkan bukti forensik
2. ‚úÖ Membunuh proses malware
3. ‚úÖ Menghapus rootkit
4. ‚úÖ Update Next.js ke versi aman (16.0.7)
5. ‚úÖ Scan untuk malware tambahan

---

## üî¥ LANGKAH 2: GANTI SEMUA CREDENTIAL (Dalam 1 Jam)

‚ö†Ô∏è **ASUMSI: Semua password dan API key telah dicuri!**

### Database & Supabase:
```bash
# Login ke Supabase Dashboard
# Settings ‚Üí Database ‚Üí Reset Password
# Settings ‚Üí API ‚Üí Regenerate Keys

# Update di server:
nano /app/backend/.env
nano /app/frontend/.env.local

# Cari dan ganti:
# - DATABASE_URL
# - DIRECT_URL
# - SUPABASE_ANON_KEY
# - SUPABASE_SERVICE_ROLE_KEY
```

### JWT Secrets:
```bash
# Generate secret baru
openssl rand -base64 64

# Update di /app/backend/.env:
# JWT_SECRET=<secret_baru>
# JWT_REFRESH_SECRET=<secret_baru_lainnya>
```

### API Keys External:
- [ ] RajaOngkir: https://rajaongkir.com/akun/api
- [ ] Payment Gateway (Midtrans/Xendit)
- [ ] Email Service
- [ ] SMS Gateway

### SSH Keys:
```bash
# Periksa authorized keys
cat ~/.ssh/authorized_keys

# Hapus yang tidak dikenal
nano ~/.ssh/authorized_keys

# Generate key baru
ssh-keygen -t ed25519 -C "recovery-$(date +%Y%m%d)"
```

**Checklist lengkap:** `credential-rotation-checklist.md`

---

## üî¥ LANGKAH 3: RESTART SERVICES

```bash
# Restart backend
cd /app/backend
npm run stop
npm run start

# Restart frontend  
cd /app/frontend
npm run build
pm2 restart frontend

# Clear cache
redis-cli FLUSHALL

# Restart nginx
sudo systemctl restart nginx
```

---

## üî¥ LANGKAH 4: VERIFIKASI & MONITORING

```bash
# Cek CPU usage (harus normal sekarang)
htop

# Cek tidak ada proses mencurigakan
ps aux --sort=-%cpu | head -20

# Cek koneksi network
sudo netstat -tulpn | grep ESTABLISHED

# Monitor logs
tail -f /var/log/syslog
tail -f /app/backend/logs/*.log

# Cek Next.js version (harus 16.0.7)
cd /app/frontend && npm list next
```

---

## üü° LANGKAH 5: ANALISIS MENDALAM (Hari Ini)

```bash
# Install security tools
sudo apt update
sudo apt install -y rkhunter chkrootkit clamav

# Scan rootkit
sudo rkhunter --check

# Scan malware
sudo freshclam
sudo clamscan -r /app --infected

# Periksa persistence mechanism
sudo systemctl list-units --type=service | grep -v "loaded active"
crontab -l
cat /etc/crontab
ls -la /etc/cron.d/
```

---

## üü° PERTIMBANGAN: REBUILD SERVER

**Recommended:** Full server rebuild untuk memastikan bersih 100%

### Jika rebuild:
1. Provision server baru
2. Deploy dari source code bersih
3. Restore database dari backup (sebelum infeksi)
4. Update semua dependencies
5. Implement security monitoring
6. Migrate traffic ke server baru

### Jika tidak rebuild:
- Risk: Hidden backdoors mungkin masih ada
- Requirement: Full security audit
- Timeline: Monitoring ketat 30 hari

---

## üìä INDICATORS OF COMPROMISE (IoC)

File mencurigakan:
```
/app/frontend/linuxsys
/etc/data/libsystem.so
/etc/ld.so.preload (modified)
```

Process:
```
PID 179300: ./linuxsys (397% CPU)
```

Behavior:
```
- High CPU usage (crypto mining)
- Rootkit injection (ld.so.preload)
- Hidden process name (fake system name)
```

---

## üõ°Ô∏è PREVENTION (Deploy Dalam 48 Jam)

### 1. Update Dependencies
```bash
cd /app/frontend
npm audit fix --force
npx npm-check-updates -u

cd /app/backend
npm audit fix --force
npx npm-check-updates -u
```

### 2. Security Monitoring
```bash
# Install fail2ban
sudo apt install fail2ban
sudo systemctl enable fail2ban
sudo systemctl start fail2ban

# Setup alerts
# - CPU usage > 80%
# - Disk usage > 90%
# - Unusual network traffic
# - Failed SSH attempts
```

### 3. Firewall Rules
```bash
# Allow only necessary ports
sudo ufw default deny incoming
sudo ufw default allow outgoing
sudo ufw allow 22/tcp   # SSH
sudo ufw allow 80/tcp   # HTTP
sudo ufw allow 443/tcp  # HTTPS
sudo ufw enable
```

### 4. Automated Security Updates
```bash
sudo apt install unattended-upgrades
sudo dpkg-reconfigure -plow unattended-upgrades
```

### 5. File Integrity Monitoring
```bash
# Install AIDE
sudo apt install aide
sudo aideinit
sudo cp /var/lib/aide/aide.db.new /var/lib/aide/aide.db

# Run daily check via cron
echo "0 5 * * * root /usr/bin/aide --check" | sudo tee -a /etc/crontab
```

---

## üìû SUPPORT

**Dokumen lengkap:**
- `incident-report.md` - Full analysis
- `credential-rotation-checklist.md` - Detailed credential rotation
- `emergency-response.sh` - Automated response script

**Evidence:**
- `/root/incident-evidence-*/` - Forensic data

---

## ‚è∞ TIMELINE EKSEKUSI

| Time | Action | Status |
|------|--------|--------|
| T+0 (NOW) | Run emergency-response.sh | ‚è≥ |
| T+30min | Rotate database credentials | ‚è≥ |
| T+1h | Rotate all API keys | ‚è≥ |
| T+2h | Restart all services | ‚è≥ |
| T+4h | Full security scan | ‚è≥ |
| T+24h | Verify no reinfection | ‚è≥ |
| T+48h | Implement prevention | ‚è≥ |
| T+7d | Security audit | ‚è≥ |

---

## üö® JANGAN LUPA:

- [ ] **SAVE EVIDENCE** sebelum cleanup
- [ ] **ROTATE ALL CREDENTIALS** (database, API, SSH)
- [ ] **NOTIFY USERS** jika data customer terekspos
- [ ] **REVIEW LOGS** untuk aktivitas mencurigakan
- [ ] **BACKUP DATA** sebelum rebuild
- [ ] **UPDATE DEPENDENCIES** setelah cleanup
- [ ] **MONITOR** selama 30 hari ke depan

---

**MULAI SEKARANG - Setiap menit berharga!**
