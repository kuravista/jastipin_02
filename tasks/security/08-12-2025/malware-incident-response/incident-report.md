# Malware Incident Report - CVE-2025-66478

**Date:** December 8, 2025
**Severity:** CRITICAL
**Status:** ACTIVE INFECTION

## Executive Summary

Server terinfeksi crypto mining malware yang mengeksploitasi Next.js CVE-2025-66478 vulnerability. Malware aktif menggunakan 397% CPU (4 cores penuh).

## Findings

### 1. Malware Process
- **Name:** `linuxsys` (fake system process name)
- **PID:** 179300
- **Location:** `/app/frontend/linuxsys` (deleted but still running)
- **CPU Usage:** 397% (4 cores @ 100%)
- **Runtime:** ~306 minutes (5+ hours)
- **Started:** Mon Dec 8 07:39:08 2025
- **Parent:** init (PID 1) - indicates persistence mechanism

### 2. Rootkit Components
- `/etc/ld.so.preload` - Modified to load malicious library
- `/etc/data/libsystem.so` - Malware library (referenced but deleted)

### 3. Vulnerability Vector
- **Next.js Version:** 16.0.0 (VULNERABLE)
- **CVE:** CVE-2025-66478 (CVSS 10.0 - Critical)
- **Safe Version:** 16.0.7+
- **Exploitation:** Remote Code Execution via React Server Components

### 4. Indicators of Compromise (IoCs)

**File System:**
```
/app/frontend/linuxsys (deleted)
/etc/ld.so.preload (modified)
/etc/data/libsystem.so (referenced, not found)
```

**Process:**
```
PID 179300: ./linuxsys (397% CPU)
```

**System Modifications:**
```
ld.so.preload injection technique (rootkit)
```

## Attack Timeline

1. **Unknown Time:** Next.js 16.0.0 deployed (vulnerable)
2. **December 8, 2025 ~07:39:** Exploitation occurred
3. **December 8, 2025 07:39:08:** Malware `linuxsys` started
4. **December 8, 2025 08:55:** Detection via htop (4 CPU @ 100%)

## Impact Assessment

**Severity: CRITICAL**

1. **Resource Exhaustion:** 4 CPU cores fully utilized (crypto mining)
2. **System Compromise:** Rootkit-level access (ld.so.preload modified)
3. **Data Exposure:** Potential access to all application data
4. **Credential Exposure:** Environment variables, secrets, database credentials
5. **Backdoor Risk:** Unknown additional persistence mechanisms
6. **Lateral Movement:** Potential compromise of connected systems

## Immediate Actions Required

### Phase 1: Containment (URGENT - Do NOW)

```bash
# 1. Kill malware process immediately
sudo kill -9 179300

# 2. Block outbound connections (prevent data exfiltration)
sudo iptables -A OUTPUT -j DROP
sudo iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
sudo iptables -A OUTPUT -m state --state ESTABLISHED,RELATED -j ACCEPT

# 3. Clean rootkit
sudo rm -f /etc/ld.so.preload
sudo rm -f /etc/data/libsystem.so
sudo ldconfig

# 4. Stop all services
sudo systemctl stop pm2-root
sudo systemctl stop nginx
cd /app/frontend && npm run stop 2>/dev/null
cd /app/backend && npm run stop 2>/dev/null
```

### Phase 2: Evidence Collection

```bash
# Collect forensic data before cleanup
mkdir -p /root/incident-evidence-2025-12-08

# Process information
ps aux > /root/incident-evidence-2025-12-08/processes.txt
sudo lsof -p 179300 > /root/incident-evidence-2025-12-08/malware-open-files.txt 2>&1

# Network connections
sudo netstat -tulpn > /root/incident-evidence-2025-12-08/network-connections.txt
sudo ss -tulpn > /root/incident-evidence-2025-12-08/socket-stats.txt

# System logs
sudo journalctl -u nginx --since "2025-12-08 07:00" > /root/incident-evidence-2025-12-08/nginx-logs.txt
sudo tail -n 1000 /var/log/syslog > /root/incident-evidence-2025-12-08/syslog.txt
sudo tail -n 1000 /var/log/auth.log > /root/incident-evidence-2025-12-08/auth-log.txt

# Check for additional malware
find /app -type f -name "linuxsys*" -o -name "*miner*" > /root/incident-evidence-2025-12-08/suspicious-files.txt
find /tmp -type f -executable > /root/incident-evidence-2025-12-08/tmp-executables.txt
find /dev/shm -type f > /root/incident-evidence-2025-12-08/shm-files.txt

# Cron jobs (persistence)
sudo crontab -l > /root/incident-evidence-2025-12-08/root-cron.txt 2>&1
cat /etc/crontab > /root/incident-evidence-2025-12-08/etc-crontab.txt

# Systemd services (persistence)
sudo systemctl list-units --type=service --all > /root/incident-evidence-2025-12-08/systemd-services.txt
ls -la /etc/systemd/system/ > /root/incident-evidence-2025-12-08/systemd-custom.txt

# SSH authorized keys
cat ~/.ssh/authorized_keys > /root/incident-evidence-2025-12-08/ssh-authorized-keys.txt
```

### Phase 3: System Hardening

```bash
# 1. Update Next.js to patched version
cd /app/frontend
npm install next@16.0.7

# 2. Scan for backdoors
sudo find / -name "*.php" -type f -exec grep -l "eval\|base64_decode\|system\|exec" {} \; 2>/dev/null
sudo find /app -type f -name "*.ts" -o -name "*.js" | xargs grep -l "eval\|Function\(" 2>/dev/null

# 3. Check for unauthorized users
cat /etc/passwd | grep -E "/bin/bash|/bin/sh"

# 4. Rotate ALL credentials
# - Database passwords
# - API keys
# - JWT secrets
# - SSH keys
# - Supabase keys
# - Third-party API tokens
```

### Phase 4: Full System Audit

```bash
# Install security tools
sudo apt update
sudo apt install -y rkhunter chkrootkit clamav

# Run rootkit hunters
sudo rkhunter --check --skip-keypress --report-warnings-only
sudo chkrootkit

# Scan for malware
sudo freshclam
sudo clamscan -r /app --infected --log=/root/incident-evidence-2025-12-08/clamav-scan.log

# Check integrity
sudo debsums -c 2>&1 | tee /root/incident-evidence-2025-12-08/package-integrity.txt
```

## Recovery Plan

### Option A: Clean Current System (NOT RECOMMENDED)
If system integrity cannot be verified, full rebuild required.

### Option B: Full Server Rebuild (RECOMMENDED)
1. Provision new server
2. Deploy from clean source code
3. Restore data from backup (verify backup is pre-infection)
4. Update all dependencies
5. Implement security monitoring
6. Rotate ALL credentials

## Prevention Measures

### 1. Immediate (Deploy Today)
- [ ] Update Next.js to 16.0.7
- [ ] Enable automatic security updates
- [ ] Implement Web Application Firewall (WAF)
- [ ] Enable fail2ban for SSH
- [ ] Setup intrusion detection (AIDE/Tripwire)

### 2. Short-term (This Week)
- [ ] Implement dependency scanning (Snyk/Dependabot)
- [ ] Setup CPU/Memory alerts
- [ ] Enable audit logging
- [ ] Implement network segmentation
- [ ] Setup log aggregation (ELK/Graylog)

### 3. Long-term (This Month)
- [ ] Security audit of entire application
- [ ] Penetration testing
- [ ] Incident response playbook
- [ ] Disaster recovery plan
- [ ] Security training for team

## Security Checklist Going Forward

```bash
# Add to CI/CD pipeline
- npm audit --audit-level=high
- npx next-security-check
- Container security scanning
- SAST (Static Application Security Testing)
- DAST (Dynamic Application Security Testing)
```

## References
- CVE-2025-66478: https://nextjs.org/blog/CVE-2025-66478
- CVE-2025-55182: https://www.cve.org/CVERecord?id=CVE-2025-55182
- React Security Advisory: https://react.dev/blog/2025/12/03/critical-security-vulnerability-in-react-server-components

## Next Steps

1. **IMMEDIATELY:** Execute Phase 1 (Containment)
2. **Within 1 hour:** Execute Phase 2 (Evidence Collection)
3. **Within 4 hours:** Execute Phase 3 (System Hardening)
4. **Within 24 hours:** Complete Phase 4 (Full Audit)
5. **Within 48 hours:** Decide on rebuild vs. clean
6. **Within 1 week:** Implement all prevention measures

## Notes

- DO NOT restart the server before evidence collection
- DO NOT delete malware files before forensics
- ASSUME all credentials are compromised
- ASSUME lateral movement has occurred
- ASSUME data exfiltration has occurred
